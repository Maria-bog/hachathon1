<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ö–∞—Ä—Ç–∞ –ø–∏—Å–µ–º –†–æ—Å—Å–∏–∏</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <link rel="stylesheet" href="/css/style.css">
</head>
<body>
    <div class="container">
        <!-- Header -->
        <header class="header">
            <div class="header-content">
                <h1 class="logo">‚úâÔ∏è –ö–∞—Ä—Ç–∞ –ø–∏—Å–µ–º –†–æ—Å—Å–∏–∏</h1>
                <p class="subtitle">–ò—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∞—è –ø–µ—Ä–µ–ø–∏—Å–∫–∞ —á–µ—Ä–µ–∑ –æ—Ç–∫—Ä—ã—Ç–∫–∏ –∏ –ø–∏—Å—å–º–∞</p>
            </div>
        </header>

        <!-- Main Content -->
        <div class="main-layout">
            <!-- Map Section -->
            <div class="map-section">
                <div class="map-container">
                    <div id="map"></div>
                </div>
            </div>

            <!-- Sidebar -->
            <div class="sidebar">
                <!-- Statistics -->
                <div class="stats-panel">
                    <h3>üìä –û–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h3>
                    <div class="stats-grid">
                        <div class="stat-item">
                            <div class="stat-number" id="totalLetters">0</div>
                            <div class="stat-label">–í—Å–µ–≥–æ –ø–∏—Å–µ–º</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-number" id="totalCities">0</div>
                            <div class="stat-label">–ì–æ—Ä–æ–¥–æ–≤</div>
                        </div>
                    </div>
                </div>

                <!-- City Info -->
                <div class="city-panel" id="cityPanel" style="display: none;">
                    <div class="city-header">
                        <h3 id="cityName">–ì–æ—Ä–æ–¥</h3>
                        <button class="close-btn" id="closePanel">√ó</button>
                    </div>
                    <div class="city-stats">
                        <div class="city-stat">
                            <span class="city-stat-label">–ü–∏—Å–µ–º:</span>
                            <span class="city-stat-value" id="cityLetterCount">0</span>
                        </div>
                    </div>
                    <div class="letters-section">
                        <h4>üì® –ü–∏—Å—å–º–∞ –∏–∑ —ç—Ç–æ–≥–æ –≥–æ—Ä–æ–¥–∞</h4>
                        <div class="letters-list" id="lettersList">
                            <!-- Letters will be loaded here -->
                        </div>
                    </div>
                </div>

                <!-- Themes -->
                <div class="themes-panel">
                    <h3>üé≠ –ü–æ–ø—É–ª—è—Ä–Ω—ã–µ —Ç–µ–º—ã</h3>
                    <div class="themes-list" id="themesList">
                        <!-- Themes will be loaded here -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Filter Panel -->
    <div class="filter-panel-debug">
        <h4>üéõÔ∏è –§–∏–ª—å—Ç—Ä—ã</h4>
        
        <div class="filter-group-debug">
            <label id="cityLimitLabel">–õ–∏–º–∏—Ç –≥–æ—Ä–æ–¥–æ–≤: 80</label>
            <input type="range" id="cityLimit" min="20" max="150" value="80" 
                   oninput="updateCityLimit(this.value)">
        </div>
        
        <div class="filter-group-debug">
            <label id="minLettersLabel">–ú–∏–Ω. –ø–∏—Å–µ–º: 3</label>
            <input type="range" id="minLetters" min="1" max="10" value="3" 
                   oninput="updateMinLetters(this.value)">
        </div>
        
        <div class="filter-group-debug">
            <label style="display: flex; align-items: center; cursor: pointer;">
                <input type="checkbox" id="showConnections" checked 
                       onchange="updateConnections(this.checked)">
                <span style="font-weight: 600; color: #555; margin-left: 8px;">–ü–æ–∫–∞–∑—ã–≤–∞—Ç—å —Å–≤—è–∑–∏</span>
            </label>
        </div>
        
        <button onclick="applyFilters()" class="apply-btn-debug">
            üîÑ –ü—Ä–∏–º–µ–Ω–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã
        </button>

        <!-- –û—Ç–ª–∞–¥–æ—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è -->
        <div class="debug-info">
            <div>–ì–æ—Ä–æ–¥–æ–≤: <span id="debugCityCount">0</span></div>
            <div>–§–∏–ª—å—Ç—Ä—ã: <span id="debugFilters">topCities=80, minLetters=3</span></div>
        </div>
    </div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script>
        // –ü—Ä–æ—Å—Ç—ã–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–æ–≤
        function updateCityLimit(value) {
            document.getElementById('cityLimitLabel').textContent = '–õ–∏–º–∏—Ç –≥–æ—Ä–æ–¥–æ–≤: ' + value;
            updateDebugInfo();
        }

        function updateMinLetters(value) {
            document.getElementById('minLettersLabel').textContent = '–ú–∏–Ω. –ø–∏—Å–µ–º: ' + value;
            updateDebugInfo();
        }

        function updateConnections(checked) {
            updateDebugInfo();
        }

        function applyFilters() {
            if (window.app && window.app.applyNewFilters) {
                window.app.applyNewFilters();
            } else {
                alert('–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –µ—â–µ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è...');
            }
        }

        function updateDebugInfo() {
            const cityLimit = document.getElementById('cityLimit').value;
            const minLetters = document.getElementById('minLetters').value;
            const showConnections = document.getElementById('showConnections').checked;
            
            document.getElementById('debugFilters').textContent = 
                `topCities=${cityLimit}, minLetters=${minLetters}, connections=${showConnections}`;
            
            if (window.app) {
                document.getElementById('debugCityCount').textContent = window.app.filteredCities ? window.app.filteredCities.length : 0;
            }
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –æ—Ç–ª–∞–¥–æ—á–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏
        document.addEventListener('DOMContentLoaded', function() {
            updateDebugInfo();
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–ª–∞–¥–æ—á–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –∫–∞–∂–¥—ã–µ 2 —Å–µ–∫—É–Ω–¥—ã
            setInterval(updateDebugInfo, 2000);
        });
    </script>
    <script src="/js/app.js"></script>
</body>
</html>